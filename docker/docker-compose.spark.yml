version: "3.4"

# IMPORTANT NOTE: Volume paths mounted on containers are relative to the
# directory that this file is in (`docker/`) and so probably need to start with
# `../` to refer to a directory in the main code checkout

volumes:
  namenode:
  datanode:

services:

  namenode:
    command: bash -c "hdfs namenode"
    volumes:
      - namenode:/hdfs:z

  datanode:
    volumes:
      - datanode:/hdfs:z
    depends_on:
      - namenode

  request_consumer:
    command: bash -c "zip -r /rec/listenbrainz_spark.zip listenbrainz_spark/ ; python spark_manage.py request_consumer"

networks:
  default:
    external:
      name: listenbrainz_default
